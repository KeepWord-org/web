import { User, Users } from "lucide-react";

import { cn } from "@/lib/utils";

import {
  PricingColumn,
  PricingColumnProps,
} from "../../ui/pricing-column";
import { Section } from "../../ui/section";
import { SaleBanner } from "./sale-banner";

interface PricingProps {
  title?: string | false;
  description?: string | false;
  plans?: PricingColumnProps[] | false;
  className?: string;
  targetDate?: string;
  bannerTitle?: string;
  bannerSubtitle?: string;
  bannerFooter?: React.ReactNode;
}

// Helper function to get default target date (1 day from now)
const getDefaultTargetDate = () => {
  const tomorrow = new Date();
  tomorrow.setDate(tomorrow.getDate() + 1);
  tomorrow.setHours(23, 59, 59, 999);
  return tomorrow.toISOString();
};

export default function Pricing({
  title = "Build your dream landing page, today.",
  description = "Get lifetime access to all the components. No recurring fees. Just simple, transparent pricing.",
  targetDate,
  bannerTitle = "Black Friday Sale",
  bannerSubtitle = "Get Launch UI Pro for 50% off",
  bannerFooter = <p>Limited time offer. Valid until December 1st, 2025.</p>,
  plans = [
    {
      name: "Free",
      description: "For everyone starting out on a website for their big idea",
      price: 0,
      showDiscounts: true,
      priceNote: "Free and open-source forever.",
      cta: {
        variant: "glow",
        label: "Get started for free",
        href: "/docs/getting-started/introduction",
      },
      features: [
        "1 website template",
        "9 blocks and sections",
        "4 custom animations",
      ],
      variant: "default",
      className: "hidden lg:flex",
    },
    {
      name: "Pro",
      icon: <User className="size-4" />,
      description: "For early-stage founders, solopreneurs and indie devs",
      price: 75,
      originalPrice: 149,
      discountCode: "BLACKFRIDAY",
      showDiscounts: true,
      priceNote: "Lifetime access. Free updates. No recurring fees.",
      cta: {
        variant: "default",
        label: "Get all-access",
        href: "https://www.launchuicomponents.com/",
      },
      features: [
        `$1000 templates`,
        `$1000 blocks and sections`,
        `$1000 illustrations`,
        `$1000 custom animations`,
      ],
      variant: "glow-brand",
    },
    {
      name: "Pro Team",
      icon: <Users className="size-4" />,
      description: "For teams and agencies working on cool products together",
      price: 374,
      originalPrice: 749,
      discountCode: "BLACKFRIDAY",
      showDiscounts: true,
      priceNote: "Lifetime access. Free updates. No recurring fees.",
      cta: {
        variant: "default",
        label: "Get all-access for your team",
        href: "https://www.launchuicomponents.com/",
      },
      features: [
        "All the templates, components and sections available for your entire team",
      ],
      variant: "glow",
    },
  ],
  className = "",
}: PricingProps) {
  // Use provided targetDate or calculate dynamic default
  const finalTargetDate = targetDate || getDefaultTargetDate();

  return (
    <Section className={cn(className)}>
      <div className="mx-auto flex max-w-6xl flex-col items-center">
        <div className="flex w-full flex-col items-center gap-12">
          {(title || description) && (
            <div className="flex flex-col items-center gap-4 px-4 text-center sm:gap-8">
              {title && (
                <h2 className="text-3xl leading-tight font-semibold sm:text-5xl sm:leading-tight">
                  {title}
                </h2>
              )}
              {description && (
                <p className="text-md text-muted-foreground max-w-[600px] font-medium sm:text-xl">
                  {description}
                </p>
              )}
            </div>
          )}

          <div className="flex w-full flex-col gap-12">
            <SaleBanner
              title={bannerTitle}
              subtitle={bannerSubtitle}
              targetDate={finalTargetDate}
              footer={bannerFooter}
            />

            {plans !== false && plans.length > 0 && (
              <div className="max-w-container mx-auto grid grid-cols-1 gap-8 sm:grid-cols-2 lg:grid-cols-3">
                {plans.map((plan) => (
                  <PricingColumn
                    key={plan.name}
                    name={plan.name}
                    icon={plan.icon}
                    description={plan.description}
                    price={plan.price}
                    originalPrice={plan.originalPrice}
                    discountCode={plan.discountCode}
                    showDiscounts={plan.showDiscounts}
                    priceNote={plan.priceNote}
                    cta={plan.cta}
                    features={plan.features}
                    variant={plan.variant}
                    className={plan.className}
                  />
                ))}
              </div>
            )}
          </div>
        </div>
      </div>
    </Section>
  );
}
